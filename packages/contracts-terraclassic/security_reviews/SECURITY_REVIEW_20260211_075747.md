# Security Review: contracts-terraclassic Package

**Date:** 2026-02-11 (UTC)  
**Epoch:** 20260211_075747  
**Unix Epoch:** 1770796667  
**Reviewer:** Security Review  
**Package:** `packages/contracts-terraclassic` (bridge CosmWasm contract)

---

## Executive Summary

This review covers the Terra Classic bridge contract implementation and tests, with emphasis on withdrawal watchtower controls, rate limiting, admin/operator/canceler RBAC, and decimal normalization safety. Current state appears secure for the reviewed scope with no High or Medium vulnerabilities found.

### Findings Summary

| Severity | Count | Summary |
|----------|-------|---------|
| High | 0 | — |
| Medium | 0 | — |
| Low/Info | 2 | Documentation/implementation mismatches |

---

## 1. Scope and Method

### In-Scope Code

- `bridge/src/contract.rs`
- `bridge/src/execute/withdraw.rs`
- `bridge/src/execute/config.rs`
- `bridge/src/execute/admin.rs`
- `bridge/src/msg.rs`
- `bridge/src/address_codec.rs`

### Validation Performed

- Static review of execution and RBAC paths.
- Consistency checks between docs/comments and implementation.
- Test execution:
  - `cargo test` in `packages/contracts-terraclassic/bridge`
  - **Result:** 192 passed, 0 failed.

---

## 2. Security Posture

### 2.1 Withdrawal Flow Controls

- `WithdrawSubmit` enforces amount > 0, source-chain registration, token support, and incoming mapping presence.
- `WithdrawApprove` requires operator/admin and marks nonce used.
- `WithdrawCancel` is restricted to canceler role and enforces cancel-window bounds.
- `WithdrawExecuteUnlock` / `WithdrawExecuteMint` require approved + not cancelled + post-window state.

### 2.2 Rate Limiting

- Per-transaction and per-period limits are enforced at execution.
- If no explicit config exists, default is based on 0.1% supply (or fallback for zero supply).
- Window accounting (`RATE_WINDOWS`) is updated atomically in execution path.

### 2.3 Decimal Normalization Safety

- Decimal scale-up uses `Uint256`/`Uint512` intermediate math and errors on overflow (`AmountOverflow`) rather than clamping.
- This mitigates silent over-crediting in high-decimal / high-amount cases.

### 2.4 Admin and Recovery Controls

- Emergency recovery requires admin + paused state.
- Admin transfer includes timelock and pending-admin acceptance.
- Operator/canceler separation is enforced in code paths.

---

## 3. Findings

### 3.1 `WithdrawCancel` Authorization Comment Mismatch (Low/Info)

**Location:** `bridge/src/msg.rs`

- `ExecuteMsg::WithdrawCancel` docs state: "Authorization: Canceler, Operator, or Admin".
- Implementation in `execute_withdraw_cancel` enforces **canceler-only** authorization.
- This is not an exploitable runtime issue, but can cause operational misunderstanding during incident response.

**Recommendation:** Update the `msg.rs` comment to "Authorization: Canceler only".

### 3.2 Withdraw Delay Minimum Comment Mismatch (Low/Info)

**Location:** `bridge/src/msg.rs`, `bridge/src/execute/config.rs`

- `SetWithdrawDelay` docs mention minimum `60` seconds.
- Runtime validation allows `15..=86400`.
- This is a documentation inconsistency that may lead to incorrect runbook assumptions.

**Recommendation:** Align docs and code to one canonical minimum; if `15` is intended, update docs accordingly.

---

## 4. Positive Security Notes

- Clear enforcement of cancel window before execution.
- Nonce reuse prevention for approved withdrawals.
- Pause gate on withdrawal execution.
- Incoming token mapping checks reduce malformed cross-chain withdrawal submissions.
- Strong address codec test coverage and transfer-hash parity tests.

---

## 5. Recommendations

| Priority | Item | Status |
|----------|------|--------|
| P1 | None | — |
| P2 | Fix `WithdrawCancel` authorization comment in `msg.rs` | Done |
| P2 | Align `SetWithdrawDelay` min value docs vs runtime validation | Done |

---

## 6. Test Evidence Snapshot

`cargo test` in `packages/contracts-terraclassic/bridge`:

- Unit tests: address codec, fee manager, hash logic
- Integration tests: deposit/withdraw/cancel/uncancel/execution/rate-limit/recovery
- Registry tests: chain and incoming token mappings
- Withdraw flow tests: lifecycle, cancel windows, normalization edge cases
- **Total:** 192 passed, 0 failed

---

*End of Security Review*
